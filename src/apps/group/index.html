<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Add this line -->
  <title>Euro Tourno</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 28px;
      margin: 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 24px;
      text-align: left;
      line-height: 60px;
    }

    td.score {
      color: blue;
      white-space: nowrap;
    }

    td.team {
      font-weight: bold;
      text-align: left;
    }

    tr.next {
      background-color: #ffffcc;
    }

    tr.scoreless td {
      font-weight: normal;
    }

    th {
      background-color: #eee;
    }

    h1 {
      background: #344b32;
      color: white;
      margin: 0;
      text-transform: uppercase;
      font-size: 1.2em;
      padding: 0.2em;
      letter-spacing: 0.1em;
    }

    button {
      margin: 8px;
      padding: 25px;
      font-size: 22px;
    }

    #match-info {
      display: none;
    }

    #match-info input {
      width: 100px;
      padding: 10px;
      font-size: 40px;
      border: 3px solid #ccc;
    }

    #score-form {
      display: table;
      margin-top: 10px;
      margin: auto;
      font-size: 1.2em;
      width: 768px;
      margin-top: 40px;
    }

    #score-form table td .input-td {
      background-color: bisque;
    }

    .score-header,
    .score-row {
      display: table-row;
    }

    .score-header>div,
    .score-row>div {
      display: table-cell;
      padding: 10px;
    }

    input[type="number"] {
      width: 100%;
    }

    .hidden {
      display: none;
    }

    .submit-container,
    #confirmation {
      margin-top: 20px;
      text-align: center;
    }

    table {
      width: 100%;
    }

    th,
    td {
      padding: 10px;
      text-align: center;
    }

    .submit-container,
    #confirmation {
      text-align: center;
      margin-top: 20px;
    }

    .hidden {
      display: none;
    }

    #score-form table td,
    #score-form table th {
      background-color: white;
      border: none;
    }
  </style>

  <style>
    #group-standings {
      display: none;
    }
  </style>

  <script>
    var CURRENT_GROUP = '';

    const showStandings = group => {
      console.log('Showing standings for group ', group)
      const fs = document.getElementById('group-standings');
        let child = fs.firstChild;
        while (child) {
          let nextChild = child.nextSibling;
          if (child.tagName !== 'H2') {
            fs.removeChild(child);
          }
          child = nextChild;
        }
      document.getElementById('group-standings').style.display = 'block'
      // FIXME: This is a hack to get the code for the group
      //        Group code should be done differently.
      //        e.g. short unique hash of full name
      const abbrev = group
        .split(' ')
        .map(x => x.substring(0, 1))
        .join('')
      console.log('Abbrev is ', abbrev)
      const jsonData = google.script.run
        .withSuccessHandler(displayDataAsTables)
        .getGroupResults(abbrev.toUpperCase())
    }

    // Function to generate table from JSON data
    const generateTable = (data, colWidths) => {
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const tbody = document.createElement("tbody");

      // Add table border style
      table.style.borderCollapse = "collapse";

      // Create table headers
      const headers = [
        'team', 'MP', 'W', 'D', 'L', 'PF', 'PA', 'PD', 'Pts'
      ]
      const headerRow = document.createElement("tr");

      headers.forEach((header, index) => {
        const th = document.createElement("th");
        th.innerText = header;
        th.style.border = "1px solid black";  // Add border to header
        if (colWidths && colWidths[index]) {
          th.style.width = `${colWidths[index]}px`;  // Set column width
        }
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);

      // Create table body
      data.forEach(row => {
        const tr = document.createElement("tr");

        headers.forEach((header, index) => {
          const td = document.createElement("td");
          td.innerText = row[header];
          td.style.border = "1px solid black";  // Add border to cell
          if (colWidths && colWidths[index]) {
            td.style.width = `${colWidths[index]}px`;  // Set column width
          }
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      return table
    }


    const displayDataAsTables = teamStatuses => {
      console.log(teamStatuses)
      let groups = {};
      teamStatuses.forEach(x => (groups[x.group] = true));
      groups = Object.keys(groups);

      const container = document.createElement("div");
      container.id = "container";

      groups.forEach(g => {
        const groupWrapper = document.createElement("div");
        groupWrapper.className = "group-wrapper";

        const rows = teamStatuses.filter(x => x.group === g);
        const h3 = document.createElement("h3");
        const group = g.split('').map(x => {
          switch (x) {
            case 'L': return 'Ladies';
            case 'M': return 'Mens';
            case 'I': return 'Intermediate group';
            case 'J': return 'Junior group';
            case 'S': return 'Senior group';
            default: return x;
          }
        }).join(' ');
        h3.innerText = group;

        groupWrapper.appendChild(h3);

        const table = generateTable(rows, [230, 25, 25, 25, 25, 25, 25, 25, 25, 25]);
        groupWrapper.appendChild(table);

        container.appendChild(groupWrapper);
      });

      document.body.appendChild(container);
    };


    const displayAvailableGroups = (groups) => {
      const ps = document.getElementById('group-select')
      groups.forEach(group => {
        const b = document.createElement('button')
        b.addEventListener('click', showStandings.bind(null, group, undefined))
        b.innerText = group
        ps.appendChild(b)
      })
    }

    // Generate table on page load
    window.onload = () => {
      const jsonData = google.script.run
        .withSuccessHandler(displayAvailableGroups)
        .gatherGroups()
    };
  </script>
</head>

<body>
  <h1>Group Overview</h1>
  <section id="group-select">
    <h2>Please select group</h2>
  </section>

  <section id="group-standings">
    <h2>Group Standings</h2>
  </section>

  <section id="group-playoffs">
  </section>

</body>

</html>